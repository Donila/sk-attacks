"use strict";;(function(){Vue.component("attack-cmp",{data:function data(){return{title:"Stronghold Kingdoms Attacks timing",attacks:[],attackForm:{attack:{armies:[],time:moment().utc().format("HH:mm"),village:""}},attackTime:moment().utc().format("HH:mm"),army:{name:"",timeToTarget:0,speedMultiplier:1,delay:0},orderedArmies:[],time:{days:0,hours:0,minutes:0,seconds:0},editingArmy:"",headers:[{text:"Name",align:"left",sortable:!1,value:"name"},{text:"Delay",value:"delay"},{text:"Time",sortable:!1},{text:"1x",sortable:!1},{text:"2x",sortable:!1},{text:"3x",sortable:!1},{text:"4x",sortable:!1},{text:"5x",sortable:!1},{text:"6x",sortable:!1}],snackBarText:"UPDATED!",snackbar:!1}},template:"\n    <div>\n    <v-form @submit.prevent=\"add(attackForm.attack)\">\n      <v-layout row fluid>\n        <v-flex xs12>\n          <v-text-field\n          label=\"Village\"\n          v-model=\"attackForm.attack.village\"\n          :rules=\"nameRules\"\n          required\n          ></v-text-field>\n        </v-flex>\n      </v-layout>\n\n        <v-layout row wrap>\n          <v-flex xs12 md3>\n            <v-layout row>\n              <v-flex xs12>\n                <v-time-picker v-model=\"attackTime\" format=\"24hr\"></v-time-picker>\n              </v-flex>\n            </v-layout>\n          </v-flex>\n          <v-flex xs12 md9>\n            <v-layout row wrap>\n              <v-flex xs12>\n                  <h2 v-if=\"!editingArmy\">Add new army</h2>\n                  <h2 v-if=\"editingArmy\">Editing {{editingArmy}}</h2>\n                  <army :army=\"army\" @army:add=\"addArmy()\" @army:save=\"saveArmy() \"v-bind:class=\"{ 'indigo lighten-3': editingArmy }\" :editingArmy=\"editingArmy\"></army>\n                \n              </v-flex>\n            </v-layout>\n          </v-flex>\n        </v-layout>\n        <v-layout row flat>\n          <v-flex xs12>\n          <h2>Armies</h2>\n            <v-data-table\n                v-bind:headers=\"headers\"\n                :items=\"attackForm.attack.armies\"\n                hide-actions\n                class=\"elevation-1\"\n              >\n              <template slot=\"items\" slot-scope=\"props\">\n                <tr v-bind:class=\"{ 'indigo lighten-3': props.item.name == editingArmy }\">\n                  <td>{{ props.item.name }}</td>\n                  <td>\n                    {{props.item.delay}}s ({{timeWithDelay(props.item)}})\n                  </td>\n                  <td class=\"text-xs-right\">\n                    {{timeWhen(props.item)}}\n                  </td>\n                  <td class=\"text-xs-right\" v-for=\"i in 6\" v-bind:class=\"{  'indigo darken-4': props.item.speedMultiplier == i }\"><a v-if=\"!editingArmy\" @click=\"changeToX(props.item, i)\"><time-list :army=\"props.item\" :x=\"i\"></time-list></a> <span v-if=\"editingArmy\"><time-list :army=\"props.item\" :x=\"i\"></time-list></span></td>\n                  <td>\n                    <v-icon @click=\"editArmy(props.item)\">mdi-pencil-circle</v-icon>\n                    <v-icon @click=\"removeArmy(props.item)\">mdi-delete-circle</v-icon>\n                  </td>\n                </tr>\n              </template>\n            </v-data-table>\n          </v-flex>\n        </v-layout>\n          <v-btn color=\"indigo\" large dark type=\"submit\" :disabled=\"!validateAttack()\">\n          <span v-if=\"!$route.params.id\">SHARE THIS ATTACK</span>\n          <span v-if=\"$route.params.id\">UPDATE</span>\n          </v-btn>\n          <v-snackbar\n            :timeout=\"6000\"\n            :top=\"false\"\n            :bottom=\"true\"\n            :right=\"false\"\n            :left=\"false\"\n            :multi-line=\"false\"\n            :vertical=\"false\"\n            v-model=\"snackbar\"\n          >\n            {{ snackBarText }}\n            <v-btn flat color=\"indigo\" @click.native=\"snackbar = false\">Close</v-btn>\n          </v-snackbar>\n          <v-spacer></v-spacer>\n          <router-link to=\"/\" v-if=\"$route.params.id\">\n            <v-btn color=\"indigo\" large dark>\n              Create new attack\n            </v-btn>\n          </router-link>\n          \n        </v-form>\n      </div>\n    ",mounted:function mounted(){this.getAll()},computed:{attackStartTime:function attackStartTime(){// if(this.attackTime && this.attackTime.split(':').length > 1) {
//   let hours = this.attackTime.split(':')[0];
//   let minutes = this.attackTime.split(':')[1];
//   return moment().hours(hours).minutes(minutes).format("dddd, MMMM Do YYYY, H:mm:ss");
// }
return this.attackTime},nameRules:function nameRules(){return[function(b){return b&&0<b.length||"Please enter vilage name."}]}},methods:{getAll:function getAll(){var _this=this;this.$route.params.id&&this.$http.get("/api/attacks/"+this.$route.params.id).then(function(b){return b.json()},function(b){_this.$router.push("/")}).then(function(b){b&&b._id&&(_this.attackForm.attack=b,_this.attackTime=moment(_this.attackForm.attack.time).utc().format("HH:mm"))})},add:function add(b){var _this2=this;if(this.validateAttack()){var c=0,d=0;this.attackTime&&1<this.attackTime.split(":").length&&(c=this.attackTime.split(":")[0],d=this.attackTime.split(":")[1]);var f=moment().utc().hours(c).minutes(d).seconds(0).millisecond(0);b.time=f.toDate(),this.$route.params.id?this.$http.put("/api/attacks/"+this.$route.params.id,b).then(function(g){return g.json()}).then(function(g){_this2.snackbar=!0}):this.$http.post("/api/attacks",b).then(function(g){return g.json()}).then(function(g){_this2.$router.push({name:"attack",params:{id:g._id}})})}},remove:function remove(b){var _this3=this;this.$http.delete("/api/attacks/"+b).then(function(){_this3.todos.forEach(function(c,d){c._id===b&&_this3.todos.splice(d,1)})})},addArmy:function addArmy(){this.validateArmy()&&(this.attackForm.attack.armies.push(Vue.util.extend({},this.army)),this.army={name:"",timeToTarget:0,speedMultiplier:1,delay:this.attackForm.attack.armies.length})},editArmy:function editArmy(b){this.editingArmy==this.army.name&&""!=this.army.name?this.saveArmy():(this.army=b,this.editingArmy=b.name)},saveArmy:function saveArmy(){this.editingArmy="",this.army={name:"",timeToTarget:0,speedMultiplier:1,delay:this.attackForm.attack.armies.length}},validateArmy:function validateArmy(){var _this4=this,b=_.filter(this.attackForm.attack.armies,function(c){return c.name==_this4.army.name});return!(0<b.length)},validateAttack:function validateAttack(){return!!this.attackForm.attack.village&&!(1>this.attackForm.attack.armies.length)},getSlowestArmy:function getSlowestArmy(){return 0<this.attackForm.attack.armies.length?_.last(_.sortBy(this.attackForm.attack.armies,function(b){return b.timeToTarget})):{name:""}},timeWhen:function timeWhen(b,c){if(c||(c=b.speedMultiplier),0<this.attackForm.attack.armies.length){var f=_.sortBy(this.attackForm.attack.armies,function(q){return q.timeToTarget});_.last(f).name;for(var d=1;d<f.length+1;d++)f[d-1].name==b.name;var g=0,j=0;this.attackTime&&1<this.attackTime.split(":").length&&(g=this.attackTime.split(":")[0],j=this.attackTime.split(":")[1]);var k=0;try{k=parseInt(b.delay)}catch(q){console.log(q),console.log("Entered delay is unsupported.")}var l=moment.duration(b.timeToTarget*b.speedMultiplier/c,"seconds"),n=moment().utc().hours(g).minutes(j).seconds(0).milliseconds(0),p=n.add(k,"seconds").subtract(l);return p.format("H:mm:ss")}return"no armies"},timeWithDelay:function timeWithDelay(b){var c=0,d=0;this.attackTime&&1<this.attackTime.split(":").length&&(c=this.attackTime.split(":")[0],d=this.attackTime.split(":")[1]);var f=0;try{f=parseInt(b.delay)}catch(j){console.log(j),console.log("Entered delay is unsupported.")}var g=moment().utc().hours(c).minutes(d).seconds(0).milliseconds(0);return g.add(f,"seconds").format("H:mm:ss")},timeToTarget:function timeToTarget(b){var c=moment.duration(b.timeToTarget,"seconds");return this.formatTime(c.hours())+":"+this.formatTime(c.minutes())+":"+this.formatTime(c.seconds())},formatTime:function formatTime(b){return 2>(b+"").length?"0"+b:b},removeArmy:function removeArmy(b){this.attackForm.attack.armies=_.filter(this.attackForm.attack.armies,function(c){return c.name!=b.name})},get1xTime:function get1xTime(b){var c=Math.floor(b*oldVal.value/newVal.value),d=Math.floor(c/3600),f=Math.floor((c-3600*d)/60);return c=c-3600*d-60*f,{days:0,hours:d,minutes:f,seconds:c}},changeToX:function changeToX(b,c){var d=_.filter(this.attackForm.attack.armies,function(f){return f.name==b.name})[0];d.timeToTarget=b.timeToTarget*b.speedMultiplier/c,b.speedMultiplier=c}}})})();